<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Module      :  Network.HTTP.Auth</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Copyright   :  See LICENSE file</span><span>
</span><a name="line-6"></a><span class="hs-comment">-- License     :  BSD</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- </span><span>
</span><a name="line-8"></a><span class="hs-comment">-- Maintainer  :  Ganesh Sittampalam &lt;ganesh@earth.li&gt;</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Portability :  non-portable (not tested)</span><span>
</span><a name="line-11"></a><span class="hs-comment">--</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- Representing HTTP Auth values in Haskell.</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- Right now, it contains mostly functionality needed by 'Network.Browser'.</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- </span><span>
</span><a name="line-15"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-16"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Auth</span><span>
</span><a name="line-17"></a><span>       </span><span class="hs-special">(</span><span> </span><a href="Network.HTTP.Auth.html#Authority"><span class="hs-identifier hs-type">Authority</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP.Auth.html#Algorithm"><span class="hs-identifier hs-type">Algorithm</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP.Auth.html#Challenge"><span class="hs-identifier hs-type">Challenge</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP.Auth.html#Qop"><span class="hs-identifier hs-type">Qop</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP.Auth.html#headerToChallenge"><span class="hs-identifier hs-var">headerToChallenge</span></a><span> </span><span class="hs-comment">-- :: URI -&gt; Header -&gt; Maybe Challenge</span><span>
</span><a name="line-23"></a><span>       </span><span class="hs-special">,</span><span> </span><a href="Network.HTTP.Auth.html#withAuthority"><span class="hs-identifier hs-var">withAuthority</span></a><span>     </span><span class="hs-comment">-- :: Authority -&gt; Request ty -&gt; String</span><span>
</span><a name="line-24"></a><span>       </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">URI</span><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span> </span><a href="Network.HTTP.Base.html"><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Base</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><a href="Network.HTTP.Utils.html"><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Utils</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><a href="Network.HTTP.Headers.html"><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Headers</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Network.HTTP.Headers.html#Header"><span class="hs-identifier hs-type">Header</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Network.HTTP.MD5Aux.html"><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">MD5Aux</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">MD5</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP.MD5Aux.html#md5s"><span class="hs-identifier hs-var">md5s</span></a><span class="hs-special">,</span><span> </span><a href="Network.HTTP.MD5Aux.html#Str"><span class="hs-identifier hs-type">Str</span></a><span class="hs-special">(</span><a href="Network.HTTP.MD5Aux.html#Str"><span class="hs-identifier hs-var">Str</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Network.HTTP.Base64.html"><span class="hs-identifier">Network</span><span class="hs-operator">.</span><span class="hs-identifier">HTTP</span><span class="hs-operator">.</span><span class="hs-identifier">Base64</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Base64</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP.Base64.html#encode"><span class="hs-identifier hs-var">encode</span></a><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Text</span><span class="hs-operator">.</span><span class="hs-identifier">ParserCombinators</span><span class="hs-operator">.</span><span class="hs-identifier">Parsec</span><span>
</span><a name="line-33"></a><span>   </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Parser</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">char</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">many</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">many1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">satisfy</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">parse</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">spaces</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sepBy1</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Char</span><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Maybe</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Word</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Word8</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-comment">-- | @Authority@ specifies the HTTP Authentication method to use for</span><span>
</span><a name="line-40"></a><span class="hs-comment">-- a given domain/realm; @Basic@ or @Digest@.</span><span>
</span><a name="line-41"></a><span class="hs-keyword">data</span><span> </span><a name="Authority"><a href="Network.HTTP.Auth.html#Authority"><span class="hs-identifier">Authority</span></a></a><span> </span><span>
</span><a name="line-42"></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="AuthBasic"><a href="Network.HTTP.Auth.html#AuthBasic"><span class="hs-identifier">AuthBasic</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="auRealm"><a href="Network.HTTP.Auth.html#auRealm"><span class="hs-identifier">auRealm</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-43"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auUsername"><a href="Network.HTTP.Auth.html#auUsername"><span class="hs-identifier">auUsername</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-44"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auPassword"><a href="Network.HTTP.Auth.html#auPassword"><span class="hs-identifier">auPassword</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-45"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auSite"><a href="Network.HTTP.Auth.html#auSite"><span class="hs-identifier">auSite</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">URI</span><span>
</span><a name="line-46"></a><span>             </span><span class="hs-special">}</span><span>
</span><a name="line-47"></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="AuthDigest"><a href="Network.HTTP.Auth.html#AuthDigest"><span class="hs-identifier">AuthDigest</span></a></a><span class="hs-special">{</span><span> </span><a name="auRealm"><a href="Network.HTTP.Auth.html#auRealm"><span class="hs-identifier">auRealm</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-48"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auUsername"><a href="Network.HTTP.Auth.html#auUsername"><span class="hs-identifier">auUsername</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-49"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auPassword"><a href="Network.HTTP.Auth.html#auPassword"><span class="hs-identifier">auPassword</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-50"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auNonce"><a href="Network.HTTP.Auth.html#auNonce"><span class="hs-identifier">auNonce</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-51"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auAlgorithm"><a href="Network.HTTP.Auth.html#auAlgorithm"><span class="hs-identifier">auAlgorithm</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Network.HTTP.Auth.html#Algorithm"><span class="hs-identifier hs-type">Algorithm</span></a><span>
</span><a name="line-52"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auDomain"><a href="Network.HTTP.Auth.html#auDomain"><span class="hs-identifier">auDomain</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">URI</span><span class="hs-special">]</span><span>
</span><a name="line-53"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auOpaque"><a href="Network.HTTP.Auth.html#auOpaque"><span class="hs-identifier">auOpaque</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-54"></a><span>             </span><span class="hs-special">,</span><span> </span><a name="auQop"><a href="Network.HTTP.Auth.html#auQop"><span class="hs-identifier">auQop</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Network.HTTP.Auth.html#Qop"><span class="hs-identifier hs-type">Qop</span></a><span class="hs-special">]</span><span>
</span><a name="line-55"></a><span>             </span><span class="hs-special">}</span><span>
</span><a name="line-56"></a><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-keyword">data</span><span> </span><a name="Challenge"><a href="Network.HTTP.Auth.html#Challenge"><span class="hs-identifier">Challenge</span></a></a><span> </span><span>
</span><a name="line-59"></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ChalBasic"><a href="Network.HTTP.Auth.html#ChalBasic"><span class="hs-identifier">ChalBasic</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="chRealm"><a href="Network.HTTP.Auth.html#chRealm"><span class="hs-identifier">chRealm</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-60"></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="ChalDigest"><a href="Network.HTTP.Auth.html#ChalDigest"><span class="hs-identifier">ChalDigest</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="chRealm"><a href="Network.HTTP.Auth.html#chRealm"><span class="hs-identifier">chRealm</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-61"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="chDomain"><a href="Network.HTTP.Auth.html#chDomain"><span class="hs-identifier">chDomain</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">URI</span><span class="hs-special">]</span><span>
</span><a name="line-62"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="chNonce"><a href="Network.HTTP.Auth.html#chNonce"><span class="hs-identifier">chNonce</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-63"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="chOpaque"><a href="Network.HTTP.Auth.html#chOpaque"><span class="hs-identifier">chOpaque</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-64"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="chStale"><a href="Network.HTTP.Auth.html#chStale"><span class="hs-identifier">chStale</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-65"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="chAlgorithm"><a href="Network.HTTP.Auth.html#chAlgorithm"><span class="hs-identifier">chAlgorithm</span></a></a><span> </span><span class="hs-glyph">::</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Network.HTTP.Auth.html#Algorithm"><span class="hs-identifier hs-type">Algorithm</span></a><span>
</span><a name="line-66"></a><span>              </span><span class="hs-special">,</span><span> </span><a name="chQop"><a href="Network.HTTP.Auth.html#chQop"><span class="hs-identifier">chQop</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Network.HTTP.Auth.html#Qop"><span class="hs-identifier hs-type">Qop</span></a><span class="hs-special">]</span><span>
</span><a name="line-67"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-68"></a><span>
</span><a name="line-69"></a><span class="hs-comment">-- | @Algorithm@ controls the digest algorithm to, @MD5@ or @MD5Session@.</span><span>
</span><a name="line-70"></a><span class="hs-keyword">data</span><span> </span><a name="Algorithm"><a href="Network.HTTP.Auth.html#Algorithm"><span class="hs-identifier">Algorithm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="AlgMD5"><a href="Network.HTTP.Auth.html#AlgMD5"><span class="hs-identifier">AlgMD5</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="AlgMD5sess"><a href="Network.HTTP.Auth.html#AlgMD5sess"><span class="hs-identifier">AlgMD5sess</span></a></a><span>
</span><a name="line-71"></a><span>    </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Network.HTTP.Auth.html#Algorithm"><span class="hs-identifier hs-type">Algorithm</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-74"></a><span>    </span><a name="local-8214565720323790731"><span class="hs-identifier">show</span></a><span> </span><a href="Network.HTTP.Auth.html#AlgMD5"><span class="hs-identifier hs-var">AlgMD5</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;md5&quot;</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-identifier">show</span><span> </span><a href="Network.HTTP.Auth.html#AlgMD5sess"><span class="hs-identifier hs-var">AlgMD5sess</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;md5-sess&quot;</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-comment">-- | </span><span>
</span><a name="line-78"></a><span class="hs-keyword">data</span><span> </span><a name="Qop"><a href="Network.HTTP.Auth.html#Qop"><span class="hs-identifier">Qop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="QopAuth"><a href="Network.HTTP.Auth.html#QopAuth"><span class="hs-identifier">QopAuth</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="QopAuthInt"><a href="Network.HTTP.Auth.html#QopAuthInt"><span class="hs-identifier">QopAuthInt</span></a></a><span>
</span><a name="line-79"></a><span>    </span><span class="hs-keyword">deriving</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-comment">-- | @withAuthority auth req@ generates a credentials value from the @auth@ 'Authority',</span><span>
</span><a name="line-82"></a><span class="hs-comment">-- in the context of the given request.</span><span>
</span><a name="line-83"></a><span class="hs-comment">-- </span><span>
</span><a name="line-84"></a><span class="hs-comment">-- If a client nonce was to be used then this function might need to be of type ... -&gt; BrowserAction String</span><span>
</span><a name="line-85"></a><span class="hs-identifier">withAuthority</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Network.HTTP.Auth.html#Authority"><span class="hs-identifier hs-type">Authority</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP.Base.html#Request"><span class="hs-identifier hs-type">Request</span></a><span> </span><a href="#local-6989586621679068637"><span class="hs-identifier hs-type">ty</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-86"></a><a name="withAuthority"><a href="Network.HTTP.Auth.html#withAuthority"><span class="hs-identifier">withAuthority</span></a></a><span> </span><a name="local-6989586621679068638"><a href="#local-6989586621679068638"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679068639"><a href="#local-6989586621679068639"><span class="hs-identifier">rq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-87"></a><span>        </span><a href="Network.HTTP.Auth.html#AuthBasic"><span class="hs-identifier hs-var">AuthBasic</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;Basic &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Network.HTTP.Auth.html#base64encode"><span class="hs-identifier hs-var">base64encode</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">auUsername</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-char">':'</span><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">auPassword</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span>        </span><a href="Network.HTTP.Auth.html#AuthDigest"><span class="hs-identifier hs-var">AuthDigest</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-89"></a><span>            </span><span class="hs-string">&quot;Digest &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-90"></a><span>             </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;username=&quot;</span><span>  </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">quo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">auUsername</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;,realm=&quot;</span><span>    </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">quo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">auRealm</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;,nonce=&quot;</span><span>    </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">quo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">auNonce</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;,uri=&quot;</span><span>      </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">quo</span></a><span> </span><a href="#local-6989586621679068644"><span class="hs-identifier hs-var">digesturi</span></a><span>
</span><a name="line-94"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;,response=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">quo</span></a><span> </span><a href="#local-6989586621679068641"><span class="hs-identifier hs-var">rspdigest</span></a><span>
</span><a name="line-95"></a><span>                       </span><span class="hs-comment">-- plus optional stuff:</span><span>
</span><a name="line-96"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679068647"><a href="#local-6989586621679068647"><span class="hs-identifier">alg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;,algorithm=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">quo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679068647"><span class="hs-identifier hs-var">alg</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">auAlgorithm</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679068648"><a href="#local-6989586621679068648"><span class="hs-identifier">o</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-string">&quot;,opaque=&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068640"><span class="hs-identifier hs-var">quo</span></a><span> </span><a href="#local-6989586621679068648"><span class="hs-identifier hs-var">o</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">auOpaque</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span>                    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">auQop</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;,qop=auth&quot;</span><span>
</span><a name="line-99"></a><span>                    </span><span class="hs-special">]</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-101"></a><span>        </span><a name="local-6989586621679068640"><a href="#local-6989586621679068640"><span class="hs-identifier">quo</span></a></a><span> </span><a name="local-6989586621679068646"><a href="#local-6989586621679068646"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'&quot;'</span><span class="hs-glyph">:</span><a href="#local-6989586621679068646"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;\&quot;&quot;</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span>        </span><a name="local-6989586621679068641"><a href="#local-6989586621679068641"><span class="hs-identifier">rspdigest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP.Auth.html#kd"><span class="hs-identifier hs-var">kd</span></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP.Auth.html#md5"><span class="hs-identifier hs-var">md5</span></a><span> </span><a href="#local-6989586621679068642"><span class="hs-identifier hs-var">a1</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679068645"><span class="hs-identifier hs-var">noncevalue</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="Network.HTTP.Auth.html#md5"><span class="hs-identifier hs-var">md5</span></a><span> </span><a href="#local-6989586621679068643"><span class="hs-identifier hs-var">a2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span>        </span><span class="hs-identifier">a1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">a2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-106"></a><span>        </span><a name="local-6989586621679068642"><a href="#local-6989586621679068642"><span class="hs-identifier">a1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">auUsername</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">auRealm</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">auPassword</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-107"></a><span>        </span><span>
</span><a name="line-108"></a><span>        </span><span class="hs-comment">{-
        If the &quot;qop&quot; directive's value is &quot;auth&quot; or is unspecified, then A2
        is:
           A2  = Method &quot;:&quot; digest-uri-value
        If the &quot;qop&quot; value is &quot;auth-int&quot;, then A2 is:
           A2  = Method &quot;:&quot; digest-uri-value &quot;:&quot; H(entity-body)
        -}</span><span>
</span><a name="line-115"></a><span>        </span><a name="local-6989586621679068643"><a href="#local-6989586621679068643"><span class="hs-identifier">a2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">rqMethod</span><span> </span><a href="#local-6989586621679068639"><span class="hs-identifier hs-var">rq</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068644"><span class="hs-identifier hs-var">digesturi</span></a><span>
</span><a name="line-116"></a><span>
</span><a name="line-117"></a><span>        </span><a name="local-6989586621679068644"><a href="#local-6989586621679068644"><span class="hs-identifier">digesturi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">rqURI</span><span> </span><a href="#local-6989586621679068639"><span class="hs-identifier hs-var">rq</span></a><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>        </span><a name="local-6989586621679068645"><a href="#local-6989586621679068645"><span class="hs-identifier">noncevalue</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">auNonce</span><span> </span><a href="#local-6989586621679068638"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-keyword">type</span><span> </span><a name="Octet"><a href="Network.HTTP.Auth.html#Octet"><span class="hs-identifier">Octet</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Word8</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">-- FIXME: these probably only work right for latin-1 strings</span><span>
</span><a name="line-123"></a><span class="hs-identifier">stringToOctets</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Network.HTTP.Auth.html#Octet"><span class="hs-identifier hs-type">Octet</span></a><span class="hs-special">]</span><span>
</span><a name="line-124"></a><a name="stringToOctets"><a href="Network.HTTP.Auth.html#stringToOctets"><span class="hs-identifier">stringToOctets</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span>
</span><a name="line-126"></a><span class="hs-identifier">base64encode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-127"></a><a name="base64encode"><a href="Network.HTTP.Auth.html#base64encode"><span class="hs-identifier">base64encode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP.Base64.html#encode"><span class="hs-identifier hs-var">Base64</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">encode</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Network.HTTP.Auth.html#stringToOctets"><span class="hs-identifier hs-var">stringToOctets</span></a><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-identifier">md5</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-130"></a><a name="md5"><a href="Network.HTTP.Auth.html#md5"><span class="hs-identifier">md5</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP.MD5Aux.html#md5s"><span class="hs-identifier hs-var">MD5</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">md5s</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Network.HTTP.MD5Aux.html#Str"><span class="hs-identifier hs-var">MD5</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">Str</span></a><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span class="hs-identifier">kd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-133"></a><a name="kd"><a href="Network.HTTP.Auth.html#kd"><span class="hs-identifier">kd</span></a></a><span> </span><a name="local-6989586621679068649"><a href="#local-6989586621679068649"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679068650"><a href="#local-6989586621679068650"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Network.HTTP.Auth.html#md5"><span class="hs-identifier hs-var">md5</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679068649"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;:&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679068650"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-134"></a><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | @headerToChallenge base www_auth@ tries to convert the @WWW-Authenticate@ header </span><span>
</span><a name="line-139"></a><span class="hs-comment">-- @www_auth@  into a 'Challenge' value.</span><span>
</span><a name="line-140"></a><span class="hs-identifier">headerToChallenge</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">URI</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Network.HTTP.Headers.html#Header"><span class="hs-identifier hs-type">Header</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Network.HTTP.Auth.html#Challenge"><span class="hs-identifier hs-type">Challenge</span></a><span>
</span><a name="line-141"></a><a name="headerToChallenge"><a href="Network.HTTP.Auth.html#headerToChallenge"><span class="hs-identifier">headerToChallenge</span></a></a><span> </span><a name="local-6989586621679068651"><a href="#local-6989586621679068651"><span class="hs-identifier">baseURI</span></a></a><span> </span><span class="hs-special">(</span><a href="Network.HTTP.Headers.html#Header"><span class="hs-identifier hs-var">Header</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679068652"><a href="#local-6989586621679068652"><span class="hs-identifier">str</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-142"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">parse</span><span> </span><a href="#local-6989586621679068653"><span class="hs-identifier hs-var">challenge</span></a><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><a href="#local-6989586621679068652"><span class="hs-identifier hs-var">str</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-143"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-144"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679068673"><a href="#local-6989586621679068673"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><a name="local-6989586621679068674"><a href="#local-6989586621679068674"><span class="hs-identifier">props</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679068673"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-145"></a><span>            </span><span class="hs-string">&quot;basic&quot;</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679068657"><span class="hs-identifier hs-var">mkBasic</span></a><span> </span><a href="#local-6989586621679068674"><span class="hs-identifier hs-var">props</span></a><span>
</span><a name="line-146"></a><span>            </span><span class="hs-string">&quot;digest&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679068658"><span class="hs-identifier hs-var">mkDigest</span></a><span> </span><a href="#local-6989586621679068674"><span class="hs-identifier hs-var">props</span></a><span>
</span><a name="line-147"></a><span>            </span><span class="hs-identifier">_</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-148"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-identifier">challenge</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>        </span><a name="local-6989586621679068653"><a href="#local-6989586621679068653"><span class="hs-identifier">challenge</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-151"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679068663"><a href="#local-6989586621679068663"><span class="hs-identifier">nme</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Network.HTTP.Auth.html#word"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-152"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">spaces</span><span>
</span><a name="line-153"></a><span>               </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679068664"><a href="#local-6989586621679068664"><span class="hs-identifier">pps</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679068654"><span class="hs-identifier hs-var">cprops</span></a><span>
</span><a name="line-154"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679068663"><span class="hs-identifier hs-var">nme</span></a><span class="hs-special">,</span><a href="#local-6989586621679068664"><span class="hs-identifier hs-var">pps</span></a><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>               </span><span class="hs-special">}</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>        </span><a name="local-6989586621679068654"><a href="#local-6989586621679068654"><span class="hs-identifier">cprops</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sepBy1</span><span> </span><a href="#local-6989586621679068656"><span class="hs-identifier hs-var">cprop</span></a><span> </span><a href="#local-6989586621679068655"><span class="hs-identifier hs-var">comma</span></a><span>
</span><a name="line-158"></a><span>
</span><a name="line-159"></a><span>        </span><a name="local-6989586621679068655"><a href="#local-6989586621679068655"><span class="hs-identifier">comma</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier hs-var">spaces</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">','</span><span> </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">spaces</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span>        </span><a name="local-6989586621679068656"><a href="#local-6989586621679068656"><span class="hs-identifier">cprop</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-162"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679068665"><a href="#local-6989586621679068665"><span class="hs-identifier">nm</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Network.HTTP.Auth.html#word"><span class="hs-identifier hs-var">word</span></a><span>
</span><a name="line-163"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'='</span><span>
</span><a name="line-164"></a><span>               </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679068666"><a href="#local-6989586621679068666"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Network.HTTP.Auth.html#quotedstring"><span class="hs-identifier hs-var">quotedstring</span></a><span>
</span><a name="line-165"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679068665"><span class="hs-identifier hs-var">nm</span></a><span class="hs-special">,</span><a href="#local-6989586621679068666"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>               </span><span class="hs-special">}</span><span>
</span><a name="line-167"></a><span>
</span><a name="line-168"></a><span>        </span><span class="hs-identifier">mkBasic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkDigest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Network.HTTP.Auth.html#Challenge"><span class="hs-identifier hs-type">Challenge</span></a><span>
</span><a name="line-169"></a><span>
</span><a name="line-170"></a><span>        </span><a name="local-6989586621679068657"><a href="#local-6989586621679068657"><span class="hs-identifier">mkBasic</span></a></a><span> </span><a name="local-6989586621679068667"><a href="#local-6989586621679068667"><span class="hs-identifier">params</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Network.HTTP.Auth.html#ChalBasic"><span class="hs-identifier hs-var">ChalBasic</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;realm&quot;</span><span> </span><a href="#local-6989586621679068667"><span class="hs-identifier hs-var">params</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>        </span><a name="local-6989586621679068658"><a href="#local-6989586621679068658"><span class="hs-identifier">mkDigest</span></a></a><span> </span><a name="local-6989586621679068668"><a href="#local-6989586621679068668"><span class="hs-identifier">params</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-173"></a><span>            </span><span class="hs-comment">-- with Maybe monad</span><span>
</span><a name="line-174"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679068669"><a href="#local-6989586621679068669"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;realm&quot;</span><span> </span><a href="#local-6989586621679068668"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-175"></a><span>               </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679068670"><a href="#local-6989586621679068670"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;nonce&quot;</span><span> </span><a href="#local-6989586621679068668"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-176"></a><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span>
</span><a name="line-177"></a><span>                    </span><a href="Network.HTTP.Auth.html#ChalDigest"><span class="hs-identifier hs-var">ChalDigest</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">chRealm</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679068669"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-178"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">chDomain</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679068659"><span class="hs-identifier hs-var">annotateURIs</span></a><span> </span><span>
</span><a name="line-179"></a><span>                                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">parseURI</span><span>
</span><a name="line-180"></a><span>                                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">words</span><span> </span><span>
</span><a name="line-181"></a><span>                                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span>
</span><a name="line-182"></a><span>                                            </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;domain&quot;</span><span> </span><a href="#local-6989586621679068668"><span class="hs-identifier hs-var">params</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">chNonce</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679068670"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-184"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">chOpaque</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;opaque&quot;</span><span> </span><a href="#local-6989586621679068668"><span class="hs-identifier hs-var">params</span></a><span>
</span><a name="line-185"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">chStale</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;true&quot;</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span>
</span><a name="line-186"></a><span>                                           </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;stale&quot;</span><span> </span><a href="#local-6989586621679068668"><span class="hs-identifier hs-var">params</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">chAlgorithm</span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679068662"><span class="hs-identifier hs-var">readAlgorithm</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-string">&quot;MD5&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;algorithm&quot;</span><span> </span><a href="#local-6989586621679068668"><span class="hs-identifier hs-var">params</span></a><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">chQop</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679068660"><span class="hs-identifier hs-var">readQop</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-string">&quot;&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><span class="hs-string">&quot;qop&quot;</span><span> </span><a href="#local-6989586621679068668"><span class="hs-identifier hs-var">params</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>                               </span><span class="hs-special">}</span><span>
</span><a name="line-190"></a><span>               </span><span class="hs-special">}</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>        </span><span class="hs-identifier">annotateURIs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">URI</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">URI</span><span class="hs-special">]</span><span>
</span><a name="line-193"></a><span class="hs-cpp">#if MIN_VERSION_network(2,4,0)</span><span>
</span><a name="line-194"></a><span>        </span><a name="local-6989586621679068659"><a href="#local-6989586621679068659"><span class="hs-identifier">annotateURIs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">relativeTo</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679068651"><span class="hs-identifier hs-var">baseURI</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span>
</span><a name="line-195"></a><span class="hs-cpp">#else</span><span>
</span><a name="line-196"></a><span>        </span><span class="hs-identifier">annotateURIs</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">u</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fromMaybe</span><span> </span><span class="hs-identifier">u</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">u</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">relativeTo</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">baseURI</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">catMaybes</span><span>
</span><a name="line-197"></a><span class="hs-cpp">#endif</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span>        </span><span class="hs-comment">-- Change These:</span><span>
</span><a name="line-200"></a><span>        </span><span class="hs-identifier">readQop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Network.HTTP.Auth.html#Qop"><span class="hs-identifier hs-type">Qop</span></a><span class="hs-special">]</span><span>
</span><a name="line-201"></a><span>        </span><a name="local-6989586621679068660"><a href="#local-6989586621679068660"><span class="hs-identifier">readQop</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679068661"><span class="hs-identifier hs-var">strToQop</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP.Utils.html#splitBy"><span class="hs-identifier hs-var">splitBy</span></a><span> </span><span class="hs-char">','</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span>        </span><a name="local-6989586621679068661"><a href="#local-6989586621679068661"><span class="hs-identifier">strToQop</span></a></a><span> </span><a name="local-6989586621679068671"><a href="#local-6989586621679068671"><span class="hs-identifier">qs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP.Utils.html#trim"><span class="hs-identifier hs-var">trim</span></a><span> </span><a href="#local-6989586621679068671"><span class="hs-identifier hs-var">qs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-204"></a><span>            </span><span class="hs-string">&quot;auth&quot;</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Network.HTTP.Auth.html#QopAuth"><span class="hs-identifier hs-var">QopAuth</span></a><span>
</span><a name="line-205"></a><span>            </span><span class="hs-string">&quot;auth-int&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Network.HTTP.Auth.html#QopAuthInt"><span class="hs-identifier hs-var">QopAuthInt</span></a><span>
</span><a name="line-206"></a><span>            </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span>        </span><a name="local-6989586621679068662"><a href="#local-6989586621679068662"><span class="hs-identifier">readAlgorithm</span></a></a><span> </span><a name="local-6989586621679068672"><a href="#local-6989586621679068672"><span class="hs-identifier">astr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><span class="hs-special">(</span><a href="Network.HTTP.Utils.html#trim"><span class="hs-identifier hs-var">trim</span></a><span> </span><a href="#local-6989586621679068672"><span class="hs-identifier hs-var">astr</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-209"></a><span>            </span><span class="hs-string">&quot;md5&quot;</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Network.HTTP.Auth.html#AlgMD5"><span class="hs-identifier hs-var">AlgMD5</span></a><span>
</span><a name="line-210"></a><span>            </span><span class="hs-string">&quot;md5-sess&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="Network.HTTP.Auth.html#AlgMD5sess"><span class="hs-identifier hs-var">AlgMD5sess</span></a><span>
</span><a name="line-211"></a><span>            </span><span class="hs-identifier">_</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-identifier">word</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">quotedstring</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Parser</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-214"></a><a name="quotedstring"><a href="Network.HTTP.Auth.html#quotedstring"><span class="hs-identifier">quotedstring</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'&quot;'</span><span>  </span><span class="hs-comment">-- &quot;</span><span>
</span><a name="line-216"></a><span>       </span><span class="hs-special">;</span><span> </span><a name="local-6989586621679068675"><a href="#local-6989586621679068675"><span class="hs-identifier">str</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">many</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">satisfy</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-char">'&quot;'</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">char</span><span> </span><span class="hs-char">'&quot;'</span><span>
</span><a name="line-218"></a><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679068675"><span class="hs-identifier hs-var">str</span></a><span>
</span><a name="line-219"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><a name="word"><a href="Network.HTTP.Auth.html#word"><span class="hs-identifier">word</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">many1</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">satisfy</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679068676"><a href="#local-6989586621679068676"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">isAlphaNum</span><span> </span><a href="#local-6989586621679068676"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679068676"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">==</span><span class="hs-char">'_'</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679068676"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">==</span><span class="hs-char">'.'</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679068676"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">==</span><span class="hs-char">'-'</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679068676"><span class="hs-identifier hs-var">x</span></a><span class="hs-operator hs-var">==</span><span class="hs-char">':'</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-222"></a></pre></body></html>